# Day01 - AHT20 温湿度采集实验

## 一、项目简介
本实验基于 STM32 微控制器，完成 AHT20 温湿度传感器的驱动编写与数据采集，并通过串口将测量结果输出至上位机。  
实验过程中分别实现了 **阻塞式** 与 **非阻塞式** 两种读取方式，用于对比不同编程模型下的程序结构差异。

---

## 二、硬件与开发环境
- MCU：STM32（CubeMX 自动生成工程）
- 传感器：AHT20 温湿度传感器
- 通信接口：
  - I2C（AHT20 数据通信）
  - USART（串口数据输出）
- 开发工具：
  - STM32CubeMX（工程生成）
  - CLion（代码编写）

---

## 三、实现内容
- 基于 HAL 库编写 AHT20 驱动
- 通过 I2C 读取温度与湿度原始数据
- 实现：
  - 阻塞式数据读取流程
  - 非阻塞式（状态机）数据读取流程
- 使用串口周期性输出温湿度测量结果

---

## 四、工程结构说明
STM32_AHT20_USART/
├── Core/ // 主程序与外设初始化代码
├── Drivers/ // HAL 库与底层驱动
├── STM32_AHT20_USART.ioc
└── README.md


---

## 五、关键技术点
- AHT20 初始化与测量触发时序
- I2C 通信流程与数据解析
- 使用状态机实现非阻塞式测量
- 启用 `sprintf` 浮点格式化输出

---

## 六、遇到的问题与解决思路
- **问题**：非阻塞读取逻辑初期较混乱  
- **原因**：对状态机分支与状态切换条件理解不够清晰  
- **解决**：通过明确“触发 → 等待 → 读取 → 处理”四个阶段，重新梳理状态划分

- **问题**：串口助手无法正确显示浮点数  
- **原因**：STM32 工程默认未启用 printf 的浮点数支持，sprintf/printf 在链接阶段未包含浮点格式化相关代码（该问题属于工具链配置问题，与传感器驱动本身无关，但会直接影响串口调试结果的正确性）
- **解决**：在工程的 CMake 配置文件中显式启用浮点数打印支持，具体做法为在对应CMakeLists .txt 文件中加入以下编译选项：
# Setup compiler settings
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)
set(CMAKE_C_EXTENSIONS ON)

# 启用 printf 浮点数支持
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -u _printf_float")


---

## 七、当前不足与后续改进方向
- 状态机结构仍可进一步简化与抽象
- 驱动层与应用层的接口设计还有优化空间
- 后续可引入定时器方式进一步完善非阻塞模型

---

## 八、学习记录
- 第一次完整独立编写 I2C 传感器驱动
- 对阻塞与非阻塞编程模型有了直观认识
